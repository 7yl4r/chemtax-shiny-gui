---
title: "Quarto Basics"
format:
  html:
    code-fold: true
    standalone: true
params:
  pigments_df_file: "pigments.rds"
---

```{R}
#|label: helper functions

library("glue")

# TODO: source("R/get_df_from_file") instead
# Helper functions ----
get_df_from_file <- function(filepath){
  # function to read the taxalist & pigment csv files.
  tryCatch({
    # when reading semicolon separated files,
    # having a comma separator causes `read.csv` to error
      df <- read.csv(filepath,
                     header = TRUE,
                     sep = ',',
                     quote = '"')
    },
    error = function(e) {
      # return a safeError if a parsing error occurs
      print(e)
    }
  )
  return(df)
}

```

```{R}
#| label: load data
# print(glue("reading from {params$pigments_df_file}"))
pigment_df <- readRDS(params$pigments_df_file)  #get_df_from_file(params$pigments_df_file)
# TODO: validate

# Update the status based on the length of the data frame
print(paste("Data loaded, length:", nrow(pigment_df)))

```

```{R}
#|label: clustering

result <- phytoclass::Cluster(
  pigment_df,
  14  # min_cluster_size
)
```

```{R}
fname = "clusters.rds"
saveRDS(result, file=fname)
print(glue("cluster result saved to file {fname}"))
```

```{R}
# print(result$cluster.list)
# plot of clusters
plot(result$cluster.plot)
```
